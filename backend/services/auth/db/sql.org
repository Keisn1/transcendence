:PROPERTIES:
:header-args:sqlite: :db auth.db :header yes
:END:
#+title: Sql

* Tables
#+begin_src sqlite
.tables
#+end_src

#+RESULTS:
: schema_migrations  users

* Users
** get all users
#+begin_src sqlite
SELECT * FROM users;
#+end_src

#+RESULTS:
| id                                   | username | email   | password_hash                                                | avatar                            | twofa_secret                                         | created_at          | updated_at          | twofa_enabled | last_seen           | is_online |
| 76cfdf80-08e4-4f3b-b455-e914e9d6aac2 | kkk      | k@k.com | $2b$10$6Wg7dPFgaMAXUc4PRP9kHuqWNpTxOqrR8z79XdUNDUYPLK6d5jZYy | /uploads/default-pfp.png          | JFACUTCOLZPFGSBDHFCWWR2IOFBUEM3TJESU4VDUMRWVCNRDPN2Q | 2025-08-23 17:03:26 | 2025-08-23 17:03:57 |             1 | 2025-08-24 13:45:46 |         0 |
| 98f0d6d2-27f2-4391-8af8-01fa157b7170 | ccc      | c@c.com | $2b$10$Qyv4U4ybD7LB4x/SdhqJ1OylJdNMB4l94zk3SkCPLSp1LGcNga2Ai | /uploads/default-pfp.png          | IAUT65J6JQUFGUCHHIZG2UZ2KVAEGLBTHIWEU5B6M5BUC5LUGR3A | 2025-08-23 17:04:19 | 2025-08-23 17:04:39 |             1 | 2025-08-24 13:29:15 |         0 |
| 8be31b81-930d-4a8d-aa16-d1cb25f2577e | aaa      | a@a.com | $2b$10$hJawvix2sQyVHQqv4YLMZutZpHmaIJZTKjeYJyH8uufhPAaIB67jK | /uploads/avatar-1756042289209.jpg |                                                      | 2025-08-23 17:35:05 | 2025-08-24 13:31:31 |             0 | 2025-08-24 13:46:03 |         0 |
| f0fe755c-71de-43e4-8e6b-73070804f2e0 | bbb      | b@b.com | $2b$10$bENR0C1eteqaH5NUYKDelePcLm3FDSUA8nT1YEYAh7Ki75ZUF.npy | /uploads/avatar-1755971804336.jpg |                                                      | 2025-08-23 17:35:21 | 2025-08-23 17:56:54 |             0 | 2025-08-24 13:46:49 |         1 |
| 5e48a519-42e6-45c6-a297-c15d031b7ffe | ddd      | d@d.com | $2b$10$jmXD6SqOKU8nYSniiX4Uw.2iUw86b20qud7.2o/5m2R43KLA1T6cW | /uploads/default-pfp.png          |                                                      | 2025-08-24 13:44:35 | 2025-08-24 13:44:35 |             0 | 2025-08-24 13:44:50 |         0 |
** get user by id
#+begin_src sqlite
SELECT id, username, avatar FROM users WHERE id =
#+end_src
** get last_seen and is_online

#+begin_src sqlite
SELECT id, last_seen, is_online FROM users;
#+end_src

#+RESULTS:
| id                                   | last_seen           | is_online |
| f3a7f773-59b7-42f1-aa53-475ad90a4f5e | 2025-08-16 10:57:32 |         0 |
| 4822a6be-b04e-4c45-b88a-a7a07d47f9aa |                     |         0 |
| 5d595a6f-6ec8-4243-be0c-6ca91d861d80 | 2025-08-16 10:58:59 |         0 |

* friendships
#+begin_src sqlite
SELECT * from friendships;
#+end_src

#+RESULTS:
| id                                   | requester_id                         | addressee_id | status  | created_at          | updated_at          |
| bf10058e-78f5-4362-8a09-6c22f80f8b51 | f3a7f773-59b7-42f1-aa53-475ad90a4f5e | f            | pending | 2025-08-16 11:46:19 | 2025-08-16 11:46:19 |

** get pending requests
#+begin_src sqlite
SELECT f.id, f.requester_id, u.username, u.avatar, f.created_at
FROM friendships f
JOIN users u ON f.requester_id = u.id
WHERE f.addressee_id = ? AND f.status = 'pending'
ORDER BY f.created_at DESC
#+end_src
